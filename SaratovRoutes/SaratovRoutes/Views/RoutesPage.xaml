<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://xamarin.com/schemas/2014/forms"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="SaratovRoutes.Views.RoutesPage"
             BackgroundColor="#FFFFFF">
    <ContentPage.Content>
        <StackLayout>
            <StackLayout Orientation="Horizontal">
                <Frame BackgroundColor="White"
             HasShadow="True"
             CornerRadius="10"
             Margin="0"
              Padding="0"
                >
                    <SearchBar x:Name="RouteSearchBar"
                       Placeholder="Поиск маршрутов по названию"
                       TextChanged="OnSearchBarTextChanged"
                       TextColor="Black"
                       PlaceholderColor="Gray" />

                </Frame>
                <Button TextColor="White" BackgroundColor="Black" FontSize="13" Clicked="ButtonAdd_Clicked"   Pressed="OnButtonPressed" Released="OnButtonReleased" Text="Добавить"></Button>
            </StackLayout>
            <Frame BackgroundColor="White"
       HasShadow="True"
       CornerRadius="10"
       Margin="0"
       Padding="0"
       >
                <StackLayout Orientation="Horizontal" HorizontalOptions="StartAndExpand" Margin="10,0,0,-3" Padding="0,0,0,0">
                    <Label Text="Город:"
                   FontAttributes="Bold"
                   FontSize="Medium"
                   TextColor="Black"
                   Margin="30,12,0,0"/>

                    <Frame BackgroundColor="White"
                    HasShadow="True"
                     BorderColor="Black"
                     CornerRadius="10"
                      Margin="0"
                      Padding="0">
                        <Picker x:Name="CityPicker" Title="Выберите город"  
                                TextColor="Black" SelectedIndexChanged="OnCitySelected"
                                BackgroundColor="White"/>
                    </Frame>
                    <Button Text="Очистить"
                    Clicked="OnClearFilterClicked"
                    Pressed="OnButtonPressed" Released="OnButtonReleased"
                    BackgroundColor="White"
                    TextColor="Black"
                    />
                </StackLayout>
            </Frame>
            <!-- CollectionView для отображения маршрутов -->
            <CollectionView x:Name="RouteView"
                            Margin="4"
                            SelectionMode="Single"
                            SelectionChanged="OnItemSelected">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Grid Padding="10">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <Frame HasShadow="True" BorderColor="LightGray" CornerRadius="10" Margin="5">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="*"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <Image Grid.Row="0" Source="{Binding ImgRoutes}" Aspect="AspectFill">
                                        <Image.GestureRecognizers>
                                            <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.ItemSelectedCommand}" CommandParameter="{Binding .}" />
                                        </Image.GestureRecognizers>
                                    </Image>

                                    <StackLayout Grid.Row="0" VerticalOptions="End" BackgroundColor="#80000000" Padding="10">
                                        <Label Text="{Binding time}" TextColor="White" FontAttributes="Bold"/>
                                        <Label Text="{Binding City}" TextColor="White" FontAttributes="Bold"/>
                                    </StackLayout>

                                    <Label Grid.Row="1" Text="{Binding Title}" FontAttributes="Bold" TextColor="Black" FontSize="Medium" Margin="5"/>
                                </Grid>
                            </Frame>
                        </Grid>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <!-- Низ страницы с кнопками -->
            <Frame BackgroundColor="White"
                   HasShadow="True"
                   CornerRadius="10"
                   Margin="2"
                   Padding="0"
                   BorderColor="Black">
                <StackLayout BackgroundColor="White" VerticalOptions="EndAndExpand" HorizontalOptions="CenterAndExpand" Orientation="Horizontal"
                             Padding="10,5,10,5" Margin="0,0,0,0">
                    <Frame BackgroundColor="LightGray"
                           HasShadow="True" CornerRadius="10"
                           Margin="1" Padding="0">
                        <ImageButton Margin="20,0,20,0" BackgroundColor="LightGray" Source="routes_icon.png" WidthRequest="50" HeightRequest="50"
                                     Pressed="OnButtonPressed" Released="OnButtonReleased"/>
                    </Frame>
                    <Frame BackgroundColor="White"
                           HasShadow="True" CornerRadius="10"
                           Margin="1" Padding="0">
                        <ImageButton Margin="20,0,20,0" BackgroundColor="White" Source="map_icon.png" Clicked="ButtonMap_Clicked" WidthRequest="50" HeightRequest="50"
                                     Pressed="OnButtonPressed" Released="OnButtonReleased"/>
                    </Frame>
                    <Frame BackgroundColor="White"
                           HasShadow="True" CornerRadius="10"
                           Margin="1" Padding="0">
                        <ImageButton Margin="20,0,20,0" BackgroundColor="White" Source="weather_icon.png" Clicked="ButtonWeather_Clicked" WidthRequest="50" HeightRequest="50"
                                     Pressed="OnButtonPressed" Released="OnButtonReleased"/>
                    </Frame>
                </StackLayout>
            </Frame>
        </StackLayout>
    </ContentPage.Content>
</ContentPage>